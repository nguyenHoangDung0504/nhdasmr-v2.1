<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download</title>
    <script src="download/JSZip.js"></script>
    <script src="download/FileSaver.js"></script>
</head>
  
<body>
      <script>
      function extractNumberFromLink(link) {
          // Tách phần số từ đường link
          let startIndex = link.lastIndexOf('/') + 1;
          let endIndex = link.lastIndexOf('.');
          endIndex = (endIndex > startIndex)?endIndex:(link.lastIndexOf('?v'));
          let number = link.substring(startIndex, endIndex);
          return number;
      }
      function downloadZip() {
          var zip = new JSZip();

          let imageLinks = [
              'https://cdn.glitch.global/36049008-0c55-496e-873e-a2f971037d73/103086-0.jpg?v=1698745286699',
              'https://cdn.glitch.global/36049008-0c55-496e-873e-a2f971037d73/103086-1.jpg?v=1698745288972',
              'https://cdn.glitch.global/36049008-0c55-496e-873e-a2f971037d73/103086-2.jpg?v=1698745290941'
          ];

          let audioLinks = [
              'https://cdn.glitch.me/36049008-0c55-496e-873e-a2f971037d73/103086track1.mp3?v=1698745306516',
              'https://cdn.glitch.global/36049008-0c55-496e-873e-a2f971037d73/103086freetalk.mp3?v=1698745292998'
          ];

          const numberOfImages = imageLinks.length;
          const numberOfAudios = audioLinks.length;

          // Hiển thị thông báo cho người dùng
          const statusElement = document.getElementById('status');
          statusElement.innerText = 'Đang nén...';

          // Tải xuống và lưu các tệp tin ảnh vào zip
          Promise.all(
              imageLinks.map(function(link) {
                  return fetch(link).then(function(res) {
                      return res.blob();
                  });
              })
          )
          .then(function(imageBlobs) {
              imageBlobs.forEach(function(blob, index) {
                  const imageNumber = extractNumberFromLink(imageLinks[index]);
                  zip.file(`${imageNumber}.jpg`, blob, { binary: true });
              });

              // Tải xuống và lưu các tệp tin âm thanh vào zip
              Promise.all(
                  audioLinks.map(function(link) {
                      return fetch(link).then(function(res) {
                          return res.blob();
                      });
                  })
              )
              .then(function(audioBlobs) {
                  audioBlobs.forEach(function(blob, index) {
                      const audioNumber = extractNumberFromLink(audioLinks[index]);
                      zip.file(`${audioNumber}.mp3`, blob, { binary: true });
                  });

                  // Tạo và tải xuống file ZIP
                  zip.generateAsync({ type: 'blob' })
                      .then(function(content) {
                          saveAs(content, 'file-name.zip');
                          // Cập nhật thông báo khi nén xong
                          statusElement.innerText = 'Nén hoàn thành!';
                      });
              });
          });
      }
    </script>
    <button onclick="downloadZip()">
        Click to download zip file.
    </button>
    <p id="status"></p>
</body>
</html>